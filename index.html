<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mlaku Mulu - Travel Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #6366f1 100%);
            background-attachment: fixed;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            color: white;
            padding: 40px 20px;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .header-features {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 30px;
        }

        /* Development Notice */
        .dev-notice {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 0 auto;
            max-width: 600px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dev-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .dev-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            line-height: 1.5;
            margin: 0;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            min-width: 120px;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            background: none;
            border: none;
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
            border-radius: 10px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-tab.active {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .card h2 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .card h3 {
            color: #3b82f6;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        /* Grid Layouts */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Trip Cards */
        .trip-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 1px solid rgba(59, 130, 246, 0.1);
            position: relative;
            overflow: hidden;
        }

        .trip-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .trip-card:hover::before {
            transform: scaleX(1);
        }

        .trip-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .trip-card h4 {
            color: #1e293b;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .trip-card .price {
            font-size: 1.5rem;
            font-weight: bold;
            color: #059669;
            margin: 15px 0;
        }

        .trip-card .destination {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .trip-card .dates {
            color: #6b7280;
            font-size: 0.85rem;
            margin-bottom: 15px;
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-confirmed {
            background: #d1fae5;
            color: #065f46;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Stats Cards */
        .stat-card {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.4);
        }

        .stat-card .number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            transition: color 0.3s ease;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 0 4px 15px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }

        .form-group:hover label {
            color: #3b82f6;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-success {
            background: #10b981;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #3b82f6;
            color: #3b82f6;
        }

        .btn-outline:hover {
            background: #3b82f6;
            color: white;
        }

        /* Alerts */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .loading::after {
            content: 'Memuat...';
            display: block;
            margin-top: 10px;
            font-size: 0.9rem;
            opacity: 0.7;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .header-features {
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                min-width: auto;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .dev-notice {
                margin: 0 10px;
                padding: 15px;
            }

            .dev-badge {
                font-size: 0.8rem;
                padding: 6px 12px;
            }

            .dev-text {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .card {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .btn {
                width: 100%;
                margin-right: 0;
            }
        }

        /* User Info */
        .user-info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 12px 18px;
            border-radius: 25px;
            font-size: 0.85rem;
            color: #374151;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .user-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.2);
        }

        .hidden {
            display: none !important;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Selection styling */
        ::selection {
            background: rgba(59, 130, 246, 0.2);
            color: #1e293b;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üåè Mlaku Mulu</h1>
            <p>Sistem Manajemen Wisata - Jelajahi Keindahan Indonesia</p>
            <div class="header-features">
                <span>üåç Indonesia</span>
                <span>üë• Wisata Grup</span>
                <span>‚ú® Pengalaman Terbaik</span>
            </div>
            
            <!-- Development Notice -->
            <div class="dev-notice">
                <div class="dev-badge">
                    <span>üöß</span>
                    <span>Dalam Pengembangan</span>
                </div>
                <p class="dev-text">Website ini masih dalam tahap pengembangan dan belum berfungsi sepenuhnya. Beberapa fitur mungkin belum tersedia atau mengalami gangguan.</p>
            </div>
        </div>

        <!-- User Info (shown when logged in) -->
        <div id="userInfo" class="user-info">
            <span id="userEmail"></span>
            <button class="btn btn-outline" style="margin: 0 0 0 10px; padding: 5px 10px; font-size: 0.8rem;" onclick="logout()">Logout</button>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('public')">üåç Trip Publik</button>
            <button class="nav-tab" onclick="showTab('auth')">üîê Login/Daftar</button>
            <button class="nav-tab" onclick="showTab('turis')">‚úàÔ∏è Dashboard Turis</button>
            <button class="nav-tab" onclick="showTab('pegawai')">üë• Dashboard Pegawai</button>
            <button class="nav-tab" onclick="showTab('owner')">üìä Dashboard Owner</button>
        </div>

        <!-- Trip Publik Tab -->
        <div id="public" class="tab-content active">
            <div class="card">
                <h2>üåç Trip Tersedia</h2>
                <p style="color: #6b7280; margin-bottom: 20px; font-style: italic;">
                    Jelajahi berbagai destinasi wisata menarik di seluruh Indonesia
                </p>
                <div id="public-trips" class="grid">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Authentication Tab -->
        <div id="auth" class="tab-content">
            <div class="card">
                <h2>üîê Login / Registrasi</h2>
                <p style="color: #6b7280; margin-bottom: 20px; font-style: italic;">
                    Daftar atau masuk ke sistem untuk mengakses fitur lengkap
                </p>
                
                <div class="form-group">
                    <label>üë§ Tipe Pengguna:</label>
                    <select id="userType" onchange="toggleNameField()">
                        <option value="turis">üèñÔ∏è Turis (Wisatawan)</option>
                        <option value="pegawai">üë• Pegawai</option>
                        <option value="owner">üëë Owner</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="authEmail" placeholder="nama@email.com">
                </div>

                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="authPassword" placeholder="Masukkan password">
                </div>

                <div class="form-group">
                    <label>Phone:</label>
                    <input type="tel" id="authPhone" placeholder="+62 812 3456 7890">
                </div>

                <div class="form-group" id="nameGroup" style="display: none;">
                    <label>Nama:</label>
                    <input type="text" id="authName" placeholder="Masukkan nama lengkap">
                </div>

                <button class="btn" onclick="register()">Daftar</button>
                <button class="btn btn-secondary" onclick="login()">Login</button>

                <div id="authMessage"></div>
            </div>

            <!-- OTP Section -->
            <div class="card" id="otpSection" style="display: none;">
                <h3>Verifikasi OTP</h3>
                <p style="margin-bottom: 20px; color: #6b7280;">Kode OTP telah dikirim ke email Anda</p>
                
                <div class="form-group">
                    <label>Kode OTP:</label>
                    <input type="text" id="otpCode" placeholder="Masukkan kode OTP" maxlength="6">
                </div>
                
                <button class="btn" onclick="verifyOTP()">Verifikasi</button>
                <button class="btn btn-outline" onclick="resendOTP()">Kirim Ulang</button>
            </div>
        </div>

        <!-- Turis Dashboard Tab -->
        <div id="turis" class="tab-content">
            <div class="card">
                <h2>‚úàÔ∏è Dashboard Turis</h2>
                <p style="color: #6b7280; margin-bottom: 20px; font-style: italic;">
                    Kelola booking dan pesan trip baru sesuai keinginan Anda
                </p>
                
                <h3>üìã Booking Saya</h3>
                <div id="turis-bookings" class="grid">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üéØ Pesan Trip Baru</h3>
                <div class="form-group">
                    <label>üèñÔ∏è Pilih Trip:</label>
                    <select id="bookingTripId">
                        <option value="">Pilih trip...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>üìù Catatan:</label>
                    <textarea id="bookingNotes" placeholder="Permintaan khusus? (opsional)"></textarea>
                </div>
                <button class="btn" onclick="bookTrip()">üéâ Pesan Trip</button>
            </div>
        </div>

        <!-- Pegawai Dashboard Tab -->
        <div id="pegawai" class="tab-content">
            <div class="card">
                <h2>üë• Dashboard Pegawai</h2>
                <p style="color: #6b7280; margin-bottom: 20px; font-style: italic;">
                    Kelola user dan monitor semua booking dalam sistem
                </p>
                
                <h3>üë§ Manajemen User</h3>
                <div id="users-list" class="grid">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üìä Semua Booking</h3>
                <div id="all-bookings" class="grid">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Owner Dashboard Tab -->
        <div id="owner" class="tab-content">
            <div class="card">
                <h2>üìä Dashboard Owner</h2>
                <p style="color: #6b7280; margin-bottom: 20px; font-style: italic;">
                    Monitor statistik sistem dan kelola semua trip yang tersedia
                </p>
                
                <h3>üìà Statistik Sistem</h3>
                <div id="owner-stats" class="stats-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üöÄ Buat Trip Baru</h3>
                <p style="color: #6b7280; margin-bottom: 20px; font-style: italic;">
                    Buat paket wisata baru untuk menarik minat turis
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <div class="form-group">
                            <label>üéØ Judul Trip:</label>
                            <input type="text" id="tripTitle" placeholder="Wisata Bali 3 Hari 2 Malam">
                        </div>
                        <div class="form-group">
                            <label>üìç Nama Destinasi:</label>
                            <input type="text" id="destName" placeholder="Bali">
                        </div>
                        <div class="form-group">
                            <label>üåç Lokasi:</label>
                            <input type="text" id="destLocation" placeholder="Bali, Indonesia">
                        </div>
                        <div class="form-group">
                            <label>‚ú® Highlights (pisahkan dengan koma):</label>
                            <input type="text" id="destHighlights" placeholder="Pantai, Pura, Budaya">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>üìÖ Tanggal Mulai:</label>
                            <input type="date" id="tripStartDate">
                        </div>
                        <div class="form-group">
                            <label>üìÖ Tanggal Selesai:</label>
                            <input type="date" id="tripEndDate">
                        </div>
                        <div class="form-group">
                            <label>üë• Kapasitas Maksimal:</label>
                            <input type="number" id="tripMaxCapacity" placeholder="15">
                        </div>
                        <div class="form-group">
                            <label>üí∞ Harga (IDR):</label>
                            <input type="number" id="tripPrice" placeholder="2000000">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>üìù Deskripsi:</label>
                    <textarea id="tripDescription" placeholder="Nikmati keindahan pulau dewata dengan pemandangan pantai yang memukau, budaya yang kaya, dan pengalaman wisata yang tak terlupakan..."></textarea>
                </div>
                <button class="btn" onclick="createTrip()">üéâ Buat Trip</button>
            </div>

            <div class="card">
                <h3>üóÇÔ∏è Semua Trip</h3>
                <div id="owner-trips" class="grid">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'http://43.134.87.90:8086';
        let currentUser = null;
        let accessToken = localStorage.getItem('accessToken');
        let refreshToken = localStorage.getItem('refreshToken');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            if (accessToken) {
                document.getElementById('userInfo').style.display = 'block';
                // Try to get user info from localStorage or API
            }
            loadPublicTrips();
        });

        // Tab Management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load data based on tab
            switch(tabName) {
                case 'public':
                    loadPublicTrips();
                    break;
                case 'turis':
                    if (accessToken) loadTurisBookings();
                    break;
                case 'pegawai':
                    if (accessToken) {
                        loadUsers();
                        loadAllBookings();
                    }
                    break;
                case 'owner':
                    if (accessToken) {
                        loadOwnerStats();
                        loadOwnerTrips();
                    }
                    break;
            }
        }

        // User Type Change Handler
        function toggleNameField() {
            const userType = document.getElementById('userType').value;
            const nameGroup = document.getElementById('nameGroup');
            nameGroup.style.display = userType === 'owner' ? 'block' : 'none';
        }

        // API Helper Functions
        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                },
                ...options
            };

            if (accessToken) {
                config.headers.Authorization = `Bearer ${accessToken}`;
            }

            try {
                const response = await fetch(url, config);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'API request failed');
                }

                return data;
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // Format functions
        function formatPrice(price) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
            }).format(price);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            });
        }

        // Authentication Functions
        async function register() {
            try {
                const userType = document.getElementById('userType').value;
                const email = document.getElementById('authEmail').value;
                const password = document.getElementById('authPassword').value;
                const phone = document.getElementById('authPhone').value;
                const name = document.getElementById('authName').value;

                let endpoint = '';
                let payload = { email, password, phone };

                if (userType === 'owner') {
                    endpoint = '/owner/register';
                    payload.name = name;
                } else if (userType === 'pegawai') {
                    endpoint = '/auth/register/pegawai';
                } else {
                    endpoint = '/auth/register/turis';
                }

                await apiCall(endpoint, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });

                showMessage('Registrasi berhasil! Silakan cek email untuk verifikasi OTP.', 'success');
                document.getElementById('otpSection').style.display = 'block';
                clearAuthForm();

            } catch (error) {
                showMessage(`Registrasi gagal: ${error.message}`, 'error');
            }
        }

        async function login() {
            try {
                const email = document.getElementById('authEmail').value;
                const password = document.getElementById('authPassword').value;

                const response = await apiCall('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });

                accessToken = response.data.access_token;
                refreshToken = response.data.refresh_token;
                localStorage.setItem('accessToken', accessToken);
                localStorage.setItem('refreshToken', refreshToken);

                currentUser = { email, role: response.data.role };
                document.getElementById('userEmail').textContent = `${email} (${response.data.role})`;
                document.getElementById('userInfo').style.display = 'block';
                
                showMessage('Login berhasil!', 'success');
                clearAuthForm();

                // Navigate to appropriate dashboard
                if (response.data.role === 'owner') {
                    showTab('owner');
                } else if (response.data.role === 'pegawai') {
                    showTab('pegawai');
                } else {
                    showTab('turis');
                }

            } catch (error) {
                showMessage(`Login gagal: ${error.message}`, 'error');
            }
        }

        async function verifyOTP() {
            try {
                const email = document.getElementById('authEmail').value;
                const otp = document.getElementById('otpCode').value;

                await apiCall('/auth/verify-otp', {
                    method: 'POST',
                    body: JSON.stringify({ email, otp })
                });

                showMessage('OTP berhasil diverifikasi! Silakan login.', 'success');
                document.getElementById('otpSection').style.display = 'none';
                document.getElementById('otpCode').value = '';

            } catch (error) {
                showMessage(`Verifikasi OTP gagal: ${error.message}`, 'error');
            }
        }

        async function resendOTP() {
            try {
                const email = document.getElementById('authEmail').value;

                await apiCall('/auth/resend-otp', {
                    method: 'POST',
                    body: JSON.stringify({ email })
                });

                showMessage('OTP berhasil dikirim ulang!', 'success');

            } catch (error) {
                showMessage(`Gagal mengirim ulang OTP: ${error.message}`, 'error');
            }
        }

        async function logout() {
            try {
                if (refreshToken) {
                    await apiCall('/auth/logout', {
                        method: 'POST',
                        body: JSON.stringify({ refresh_token: refreshToken })
                    });
                }
            } catch (error) {
                console.error('Logout error:', error);
            } finally {
                accessToken = null;
                refreshToken = null;
                currentUser = null;
                localStorage.removeItem('accessToken');
                localStorage.removeItem('refreshToken');
                document.getElementById('userInfo').style.display = 'none';
                showMessage('Logout berhasil!', 'success');
                showTab('public');
            }
        }

        // Data Loading Functions
        async function loadPublicTrips() {
            try {
                const response = await apiCall('/trips?page=1&limit=20');
                displayTrips(response.data || [], 'public-trips');
                
                // Populate booking dropdown
                const select = document.getElementById('bookingTripId');
                select.innerHTML = '<option value="">Pilih trip...</option>';
                (response.data || []).forEach(trip => {
                    const option = document.createElement('option');
                    option.value = trip.id;
                    option.textContent = trip.title;
                    select.appendChild(option);
                });
            } catch (error) {
                document.getElementById('public-trips').innerHTML = 
                    `<div class="alert alert-error">Gagal memuat trip: ${error.message}</div>`;
            }
        }

        async function loadTurisBookings() {
            try {
                const response = await apiCall('/trips/bookings/me?page=1&limit=20');
                displayBookings(response.data || [], 'turis-bookings');
            } catch (error) {
                document.getElementById('turis-bookings').innerHTML = 
                    `<div class="alert alert-error">Gagal memuat booking: ${error.message}</div>`;
            }
        }

        async function loadUsers() {
            try {
                const response = await apiCall('/users?page=1&limit=20');
                displayUsers(response.data || [], 'users-list');
            } catch (error) {
                document.getElementById('users-list').innerHTML = 
                    `<div class="alert alert-error">Gagal memuat user: ${error.message}</div>`;
            }
        }

        async function loadAllBookings() {
            try {
                const response = await apiCall('/trips/bookings/all?page=1&limit=20');
                displayBookings(response.data || [], 'all-bookings');
            } catch (error) {
                document.getElementById('all-bookings').innerHTML = 
                    `<div class="alert alert-error">Gagal memuat booking: ${error.message}</div>`;
            }
        }

        async function loadOwnerStats() {
            try {
                const response = await apiCall('/owner/dashboard/stats');
                displayOwnerStats(response.data);
            } catch (error) {
                document.getElementById('owner-stats').innerHTML = 
                    `<div class="alert alert-error">Gagal memuat statistik: ${error.message}</div>`;
            }
        }

        async function loadOwnerTrips() {
            try {
                const response = await apiCall('/trips/owner/all?page=1&limit=20');
                displayTrips(response.data || [], 'owner-trips');
            } catch (error) {
                document.getElementById('owner-trips').innerHTML = 
                    `<div class="alert alert-error">Gagal memuat trip: ${error.message}</div>`;
            }
        }

        // Trip Functions
        async function bookTrip() {
            try {
                const tripId = document.getElementById('bookingTripId').value;
                const notes = document.getElementById('bookingNotes').value;

                if (!tripId) {
                    showMessage('Silakan pilih trip', 'error');
                    return;
                }

                await apiCall('/trips/book', {
                    method: 'POST',
                    body: JSON.stringify({ tripId, notes })
                });

                showMessage('Trip berhasil dipesan!', 'success');
                document.getElementById('bookingTripId').value = '';
                document.getElementById('bookingNotes').value = '';
                loadTurisBookings();

            } catch (error) {
                showMessage(`Gagal memesan trip: ${error.message}`, 'error');
            }
        }

        async function createTrip() {
            try {
                const title = document.getElementById('tripTitle').value;
                const description = document.getElementById('tripDescription').value;
                const destName = document.getElementById('destName').value;
                const destLocation = document.getElementById('destLocation').value;
                const highlights = document.getElementById('destHighlights').value.split(',').map(h => h.trim()).filter(h => h);
                const startDate = document.getElementById('tripStartDate').value;
                const endDate = document.getElementById('tripEndDate').value;
                const maxCapacity = parseInt(document.getElementById('tripMaxCapacity').value);
                const price = parseInt(document.getElementById('tripPrice').value);

                if (!title || !description || !destName || !startDate || !endDate) {
                    showMessage('Silakan isi semua field yang diperlukan', 'error');
                    return;
                }

                const payload = {
                    title,
                    description,
                    destination: {
                        name: destName,
                        location: destLocation,
                        description: `Trip to ${destName}`,
                        highlights
                    },
                    startDate: new Date(startDate).toISOString(),
                    endDate: new Date(endDate).toISOString(),
                    maxCapacity,
                    price
                };

                await apiCall('/trips', {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });

                showMessage('Trip berhasil dibuat!', 'success');
                clearCreateTripForm();
                loadOwnerTrips();
                loadPublicTrips();

            } catch (error) {
                showMessage(`Gagal membuat trip: ${error.message}`, 'error');
            }
        }

        // Display Functions
        function displayTrips(trips, containerId) {
            const container = document.getElementById(containerId);
            if (!trips || trips.length === 0) {
                container.innerHTML = '<div class="alert alert-info">Tidak ada trip ditemukan</div>';
                return;
            }

            container.innerHTML = trips.map(trip => `
                <div class="trip-card">
                    <h4>${trip.title}</h4>
                    <p style="color: #6b7280; margin-bottom: 15px;">${trip.description}</p>
                    <div class="price">${formatPrice(trip.price)}</div>
                    <div class="destination">üìç ${trip.destination?.name || 'N/A'}</div>
                    <div class="dates">
                        üìÖ ${formatDate(trip.startDate)} - ${formatDate(trip.endDate)}
                    </div>
                    <div style="color: #6b7280; font-size: 0.9rem; margin-bottom: 10px;">
                        üë• ${trip.currentBookings || 0}/${trip.maxCapacity || 'N/A'} peserta
                    </div>
                    ${trip.destination?.highlights ? `<div style="font-size: 0.85rem; color: #6b7280;">‚ú® ${trip.destination.highlights.join(', ')}</div>` : ''}
                </div>
            `).join('');
        }

        function displayBookings(bookings, containerId) {
            const container = document.getElementById(containerId);
            if (!bookings || bookings.length === 0) {
                container.innerHTML = '<div class="alert alert-info">Tidak ada booking ditemukan</div>';
                return;
            }

            container.innerHTML = bookings.map(booking => `
                <div class="trip-card">
                    <h4>${booking.trip?.title || 'N/A'}</h4>
                    <div class="status-badge status-${booking.status}">${booking.status}</div>
                    <p><strong>User:</strong> ${booking.user?.email || 'N/A'}</p>
                    <p><strong>Catatan:</strong> ${booking.notes || 'Tidak ada catatan'}</p>
                    <div class="dates">
                        Dipesan: ${formatDate(booking.createdAt)}
                    </div>
                    ${booking.trip ? `
                        <p><strong>Destinasi:</strong> ${booking.trip.destination?.name || 'N/A'}</p>
                        <p><strong>Harga:</strong> ${formatPrice(booking.trip.price || 0)}</p>
                    ` : ''}
                </div>
            `).join('');
        }

        function displayUsers(users, containerId) {
            const container = document.getElementById(containerId);
            if (!users || users.length === 0) {
                container.innerHTML = '<div class="alert alert-info">Tidak ada user ditemukan</div>';
                return;
            }

            container.innerHTML = users.map(user => `
                <div class="trip-card">
                    <h4>${user.email}</h4>
                    <p><strong>Role:</strong> ${user.role}</p>
                    <p><strong>Phone:</strong> ${user.phone || 'N/A'}</p>
                    <p><strong>Verified:</strong> ${user.isVerified ? '‚úÖ Ya' : '‚ùå Tidak'}</p>
                </div>
            `).join('');
        }

        function displayOwnerStats(stats) {
            const container = document.getElementById('owner-stats');
            container.innerHTML = `
                <div class="stat-card">
                    <div class="number">${stats.userOverview?.totalUsers || 0}</div>
                    <div class="label">Total Users</div>
                </div>
                <div class="stat-card">
                    <div class="number">${stats.userOverview?.verifiedUsers || 0}</div>
                    <div class="label">Users Terverifikasi</div>
                </div>
                <div class="stat-card">
                    <div class="number">${stats.tripStatistics?.totalTrips || 0}</div>
                    <div class="label">Total Trip</div>
                </div>
                <div class="stat-card">
                    <div class="number">${stats.userOverview?.verificationRate || '0%'}</div>
                    <div class="label">Tingkat Verifikasi</div>
                </div>
            `;
        }

        // Utility Functions
        function showMessage(message, type) {
            const messageDiv = document.getElementById('authMessage');
            messageDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        function clearAuthForm() {
            document.getElementById('authEmail').value = '';
            document.getElementById('authPassword').value = '';
            document.getElementById('authPhone').value = '';
            document.getElementById('authName').value = '';
        }

        function clearCreateTripForm() {
            document.getElementById('tripTitle').value = '';
            document.getElementById('tripDescription').value = '';
            document.getElementById('destName').value = '';
            document.getElementById('destLocation').value = '';
            document.getElementById('destHighlights').value = '';
            document.getElementById('tripStartDate').value = '';
            document.getElementById('tripEndDate').value = '';
            document.getElementById('tripMaxCapacity').value = '';
            document.getElementById('tripPrice').value = '';
        }
    </script>
</body>
</html>